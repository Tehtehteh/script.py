<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" href="{{ static('css/bootstrap.min.css') }}" type = "text/css"/>
    <link rel="stylesheet" href="{{ static('css/my.css') }}" type = "text/css"/>
    <script type="text/javascript" href="{{ static('js/my.js') }}"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <meta charset="UTF-8">
    <title>Nice monitor such wow</title>
</head>
<script>
    $(document).ready(loadFiles("{{user}}"));

function loadFiles(username){
    $.ajax({
        url: "api/files/" + username,
        type: "GET",
        success: function(files){
            for (var i =0; i < files.length; i++){
                $("<tr>\n<th scope='row'>" + (i+1) + "</th>\n" + getFlag(files[i]) + "<td>" + files[i].path +
                "</td>\n<td>" + files[i].path.split(".")[files[i].path.split(".").length-1] + "</td>").hide().appendTo(".my-tbody").fadeIn(i*20 + 1000);

            }}
        });
}

function getFlag(file){
    console.log(file[0])
    switch (file){
        case file.old_hash!="" &&  file.new_hash!="":{
            return "<td><span class=\"label label-warning\">Changed</span></td>";
            break;
        }
        case file.flag_exists == 0:{
            return "<td><span class=\"label label-danger\">Removed</span></td>";
            break;
        }
        case file.old_hash == file.new_hash:{
            return "<td><span class=\"label label-success\">Checked</span></td>";
            break;
        }
        case file.old_hash=="" && file.flag_exists==1:{
            return "<td><span class=\"label label-info\">New</span></td>"
        }
    }
}
</script>
<body>
        <div class="panel panel-default">
            <div class="panel-heading">
                <button class="btn btn-default" onclick="return location.href='/'"><</button>
                <span>Статистика файлов <strong> {{user}}</strong></span>
            </div>
            <div class="panel-body">
                <div class="row my-row">
                    <div class="col-sm-3">
                        <ul class="list-group">
                            {% if not error|length %}
                          <li class="list-group-item">Количество всех файлов
                            <span class="badge">{{file_list|length}}</span>
                          </li>
                            {% for extension in extensions %}
                            <li class="list-group-item">Количество файлов с расширением {{ extension }}
                            <span class="badge">{{ extensions[extension] }}</span>
                            </li>
                            {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                    <button class="btn btn-primary" style="float: right; margin-right: 20px;" onclick="loadFiles({{user}})">Принять изменения</button>
                </div>
            </div>
            <div class="panel-footer">

            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading"><strong>File list</strong></div>
            <table class="table">
                <thead>
                    <th>#</th>
                    <th>Флаг</th>
                    <th>Имя файла (абсолютный путь)</th>
                    <th>Расширение</th>
                </thead>
                <tbody class="my-tbody">

                </tbody>
            </table>
            <div class="panel-footer">
                <p>© Tehtehteh 2016</p>
            </div>
        </div>
</body>
</html>